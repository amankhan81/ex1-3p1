<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cambridge IGCSE™ English as a Second Language (0510/12)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Print Styles -->
    <style>
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { 
                background: white; 
                color: black; 
                height: auto !important; 
                overflow: visible !important; 
            }
            #root { 
                height: auto !important; 
                overflow: visible !important; 
                display: block !important;
            }
            .page-break { page-break-before: always; }
            .break-inside-avoid { break-inside: avoid; }
            
            /* Hide scrollbars in print */
            ::-webkit-scrollbar { display: none; }
        }
        /* Custom Scrollbar for better UX */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 font-sans h-screen flex flex-col overflow-hidden">
    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const Clock = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
        );
        const CheckCircle = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
        );
        const AlertCircle = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
        );
        const ChevronLeft = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="15 18 9 12 15 6"></polyline></svg>
        );
        const ChevronRight = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="9 18 15 12 9 6"></polyline></svg>
        );
        const Printer = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
        );

        // --- HELPER: GRADING LOGIC ---
        const checkTextAnswer = (userAnswer, correctVariants) => {
            if (!userAnswer) return false;
            const normalizedUser = userAnswer.trim().toLowerCase();
            return correctVariants.some(variant => 
                normalizedUser === variant.trim().toLowerCase() || 
                normalizedUser.includes(variant.trim().toLowerCase()) // generous marking
            );
        };

        // --- DATA: EXAM CONTENT ---
        const EXAM_DATA = {
          meta: {
            title: "Cambridge IGCSE™ English as a Second Language (0510/12)",
            paper: "Paper 1 Reading and Writing",
            date: "May/June 2024",
            durationMinutes: 40,
            totalMarks: 15
          },
          exercises: [
            {
              id: 1,
              title: "Exercise 1 Reading",
              type: "short-answer",
              instructions: "Read the article about animals called green turtles, and then answer the questions.",
              text: `The green turtle

The green turtle is the second largest of the seven species of sea turtle and grows to a length of around 140 centimetres. It spends most of its life in the open ocean. The hard, protective shell covering its back is often green in colour, and you might assume it is this feature which gives the turtle its name. However, it actually comes from the fat beneath the shell, which is a delicate shade of green. This species of turtle has two bone-like plates near its eyes that distinguish it from other species of turtle, which have more.

Female green turtles return to the beach where they were born to lay their eggs. They dig a large hole before filling it with up to 200 eggs, which they cover with sand. Foxes eat turtle eggs if they can find them, so the sand provides protection. The babies emerge at night and head for the sea, but even so, many tiny turtles are eaten by birds as they make their way down the beach. The turtles feed primarily on small creatures at this stage but consume increasing quantities of plant-based materials as they mature. When they are fully grown, they are totally vegetarian, the only turtle species to be so.

Apart from when they are new-born or laying eggs, green turtles spend their entire lives at sea. Few animals are large or powerful enough to eat an adult green turtle, although tiger sharks occasionally attack them. Green turtles are capable of holding their breath for around five minutes when active but can do so for several hours when sleeping. This avoids the need for them to stay close to the surface, where it's not safe, and allows them to remain hidden among rocks when inactive at night.

Male and female green turtles can look surprisingly similar. Size is not necessarily a good indication of which is which, as mature males and females are roughly similar in length and weight. Additionally, a male that is larger than a female may simply be older. It has a longer tail when compared to the female, and it is this feature which is used to identify the gender.

Green turtle numbers worldwide are declining. They can accidentally eat plastic waste in the sea, which is a serious threat for them, and they sometimes get caught in fishing nets too. The International Union for Conservation of Nature lists animals and plants according to how common or threatened they are. Two of the seven types of sea turtle, the green turtle included, are seen by the organisation as endangered, so it's not just conservationists who should be concerned: we all need to be!`,
              questions: [
                { 
                  id: "q1", 
                  text: "Where does the green turtle get its name from?", 
                  marks: 1, 
                  answer: "fat beneath shell", 
                  variants: ["fat beneath shell", "fat beneath the shell", "the fat beneath the shell"]
                },
                { 
                  id: "q2", 
                  text: "What makes the diet of adult green turtles different from other turtle species?", 
                  marks: 1, 
                  answer: "vegetarian", 
                  variants: ["vegetarian", "totally vegetarian", "they are vegetarian"]
                },
                { 
                  id: "q3", 
                  text: "Where do green turtles usually sleep while underwater?", 
                  marks: 1, 
                  answer: "rocks", 
                  variants: ["rocks", "hidden among rocks", "among rocks", "in rocks"]
                },
                { 
                  id: "q4", 
                  text: "How does a male green turtle differ from a female?", 
                  marks: 1, 
                  answer: "longer tail", 
                  variants: ["longer tail", "long tail", "has a longer tail", "a longer tail"]
                },
                { 
                  id: "q5", 
                  text: "How are green turtles described by the International Union for Conservation of Nature?", 
                  marks: 1, 
                  answer: "endangered", 
                  variants: ["endangered", "as endangered"]
                },
                { 
                  id: "q6", 
                  text: "How are green turtles put in danger during their lives? Give three details.", 
                  marks: 3, 
                  answer: "1. foxes eat eggs\n2. eaten by birds\n3. tiger sharks attack\n4. eat plastic\n5. caught in nets",
                  validPoints: ["foxes", "eat eggs", "birds", "eaten by birds", "tiger sharks", "sharks", "eat plastic", "plastic", "nets", "fishing nets", "caught in nets"], 
                  parts: [
                    { id: "q6_1", label: "Detail 1" },
                    { id: "q6_2", label: "Detail 2" },
                    { id: "q6_3", label: "Detail 3" }
                  ]
                }
              ]
            },
            {
              id: 3,
              title: "Exercise 3 Note Taking",
              type: "note-making",
              instructions: "Read the article about underground homes, and then complete the notes.",
              text: `Underground homes

Many thousands of years ago, long before the development of houses, people found shelter underground in caves that were either naturally formed or created by early humans. In recent years, there has been a trend towards living underground once more, in homes that are partly or almost entirely buried or surrounded by rock. Although interest in this type of home is steadily growing, suitable sites are limited, so it is unlikely that we will all end up living in one in the near future. Part of the attraction of building an underground home is that construction costs are low if an appropriate location can be found.

Underground homes vary a great deal in their design. Some are completely underground except for one external wall, in which there is a door to allow entry into the property and perhaps some windows. This type of home may lack interior light, which many people find a struggle to cope with. These homes are, however, extremely energy efficient as heat cannot easily escape from them into the surrounding atmosphere. An example of this type of home can be found in the mid-western United States. Home to a family of four, most of the building is hidden inside a small, grass-covered hill, which reduces damage to the landscape. An unexpected issue that can sometimes occur with this kind of home, which has trees and plants growing on top of it, is that the roots can damage the building. However, a special protective material is usually fitted to the building to prevent this from happening.

Other homes are only partly underground, and sections of their structure may appear very similar to more conventional houses from the front. One such property in Spain, for instance, looks exactly like a normal house when viewed from outside, with a typical roof, several windows and a front door facing out onto the road. However, a large amount of the living space is hidden in the hill behind it. As with all underground homes, this astonishing property is far easier to maintain than traditional houses, which is one of the many things that might attract a buyer.

Anyone exploring an underground home for the first time is highly likely to notice a particular characteristic which appeals to many people: the complete lack of background noise. When your home is covered or surrounded by tonnes and tonnes of soil or rock, very little sound can get in from outside. Another feature of underground homes, which is less favourable, is the poor air quality found in many of them. However, for those people who have chosen to buy an underground home, they generally find that there are more benefits to living in such buildings than there are disadvantages.`,
              questions: [
                {
                  id: "q8",
                  text: "Benefits which make underground homes popular:",
                  marks: 4,
                  subQuestions: [
                    { id: "q8_1", label: "Benefit 1", answer: "construction costs low", variants: ["construction costs low", "low construction costs", "costs low"] },
                    { id: "q8_2", label: "Benefit 2", answer: "energy efficient", variants: ["energy efficient", "heat cannot easily escape"] },
                    { id: "q8_3", label: "Benefit 3", answer: "reduces damage to landscape", variants: ["reduces damage to landscape", "less damage to landscape"] },
                    { id: "q8_4", label: "Benefit 4", answer: "easier to maintain", variants: ["easier to maintain", "easy to maintain"] },
                  ],
                  // Extra valid point from text/MS: "lack of background noise"
                },
                {
                  id: "q9",
                  text: "Disadvantages of underground homes:",
                  marks: 3,
                  subQuestions: [
                    { id: "q9_1", label: "Disadvantage 1", answer: "sites limited", variants: ["sites limited", "suitable sites limited", "limited sites"] },
                    { id: "q9_2", label: "Disadvantage 2", answer: "lack interior light", variants: ["lack interior light", "lack of interior light", "lack light", "no light"] },
                    { id: "q9_3", label: "Disadvantage 3", answer: "roots damage the building", variants: ["roots damage the building", "roots damage building", "roots can damage"] },
                  ]
                  // Extra valid point from text/MS: "poor air quality"
                }
              ]
            }
          ]
        };

        // --- COMPONENTS ---

        const Header = ({ title, paper, timeRemaining, isSubmitted }) => {
          const formatTime = (seconds) => {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
          };

          return (
            <header className="bg-slate-800 text-white p-4 flex justify-between items-center shadow-md no-print">
              <div>
                <h1 className="font-bold text-lg md:text-xl">{title}</h1>
                <p className="text-xs text-slate-400">{paper}</p>
              </div>
              <div className="flex flex-col items-end">
                <div className={`flex items-center gap-2 font-mono text-xl ${timeRemaining < 300 ? 'text-red-400 animate-pulse' : 'text-cyan-400'}`}>
                    <Clock size={20} />
                    {isSubmitted ? <span>Ended</span> : <span>{formatTime(timeRemaining)}</span>}
                </div>
                <div className="text-[10px] text-gray-300 mt-1 font-mono">Created by Amanullah Khan</div>
              </div>
            </header>
          );
        };

        const Navigation = ({ exercises, currentExerciseIndex, setIndex, answers, isSubmitted }) => {
          return (
            <nav className="bg-white border-b border-gray-200 overflow-x-auto no-print">
              <div className="flex px-2 py-2 gap-2 min-w-max">
                {exercises.map((ex, idx) => {
                  const hasAnswer = answers[ex.id] && Object.keys(answers[ex.id]).length > 0;
                  return (
                    <button
                      key={ex.id}
                      onClick={() => setIndex(idx)}
                      className={`px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center gap-2
                        ${currentExerciseIndex === idx 
                          ? 'bg-blue-600 text-white shadow' 
                          : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                        }`}
                    >
                      {ex.title}
                      {!isSubmitted && hasAnswer && <div className="w-2 h-2 rounded-full bg-green-500" />}
                    </button>
                  );
                })}
              </div>
            </nav>
          );
        };

        const TextPanel = ({ text, title }) => {
          if (!text) return null;
          return (
            <div className="h-full overflow-y-auto p-6 bg-slate-50 text-gray-800 leading-relaxed font-serif text-lg border-r border-gray-200 no-print">
              <h2 className="font-bold text-xl mb-4 text-slate-900 border-b pb-2">{title}</h2>
              <div className="whitespace-pre-wrap">{text}</div>
            </div>
          );
        };

        const QuestionPanel = ({ exercise, answers, setAnswer, isSubmitted }) => {
          const handleInput = (id, value) => {
            if (isSubmitted) return;
            setAnswer(exercise.id, id, value);
          };

          const renderQuestions = () => {
            switch (exercise.type) {
              case 'short-answer':
                return (
                  <div className="space-y-6">
                    {exercise.questions.map((q) => {
                      // Grading Check for Review Mode
                      const userAns = answers[exercise.id]?.[q.id] || '';
                      let isCorrect = false;
                      if(isSubmitted) {
                         if (q.variants) {
                             isCorrect = checkTextAnswer(userAns, q.variants);
                         } 
                      }

                      return (
                        <div key={q.id} className={`p-4 rounded-lg shadow-sm border break-inside-avoid ${isSubmitted && q.variants ? (isCorrect ? 'bg-green-50 border-green-300' : 'bg-red-50 border-red-300') : 'bg-white border-gray-200'}`}>
                          <div className="flex justify-between items-start mb-2">
                            <span className="font-bold text-blue-800">{q.id.toUpperCase()}</span>
                            <span className="text-xs bg-gray-100 px-2 py-1 rounded text-gray-500">[{q.marks} mark{q.marks > 1 ? 's' : ''}]</span>
                          </div>
                          <p className="mb-3 font-medium text-gray-800">{q.text}</p>
                          
                          {q.parts ? (
                             <div className="space-y-3 mt-2">
                               {q.parts.map((part) => {
                                 const partAns = answers[exercise.id]?.[part.id] || '';
                                 let partCorrect = false;
                                 if (isSubmitted && q.validPoints) {
                                     partCorrect = checkTextAnswer(partAns, q.validPoints);
                                 }
                                 
                                 return (
                                   <div key={part.id} className="flex flex-col gap-1">
                                      <label htmlFor={part.id} className="text-sm font-semibold text-gray-600">{part.label}</label>
                                      <input
                                        id={part.id}
                                        type="text"
                                        value={partAns}
                                        onChange={(e) => handleInput(part.id, e.target.value)}
                                        className={`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${isSubmitted ? (partCorrect ? 'border-green-500 bg-green-100' : 'border-red-400 bg-red-50') : 'border-gray-300'}`}
                                        placeholder="Type a detail here..."
                                        disabled={isSubmitted}
                                      />
                                   </div>
                                 );
                               })}
                             </div>
                          ) : (
                            <input
                              type="text"
                              value={userAns}
                              onChange={(e) => handleInput(q.id, e.target.value)}
                              className={`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${isSubmitted && q.variants ? (isCorrect ? 'border-green-500 bg-green-100' : 'border-red-400') : 'border-gray-300'}`}
                              placeholder="Type your answer here..."
                              disabled={isSubmitted}
                            />
                          )}
                          
                          {isSubmitted && (
                            <div className="mt-3 p-3 bg-gray-50 border border-gray-200 rounded text-sm text-gray-800">
                              <strong>Model Answer(s):</strong> <div className="whitespace-pre-wrap mt-1 text-blue-800">{q.variants ? q.variants.join(" / ") : q.answer}</div>
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                );

              case 'note-making':
                return (
                  <div className="space-y-8">
                    {exercise.questions.map((q) => (
                      <div key={q.id} className="bg-white p-5 rounded-lg shadow-sm border border-gray-200 break-inside-avoid">
                        <h3 className="font-bold text-lg text-gray-800 mb-4 border-b pb-2 flex justify-between">
                          <span>{q.text}</span>
                          <span className="text-sm font-normal text-gray-500 ml-2">[{q.marks} marks]</span>
                        </h3>
                        <div className="space-y-4">
                          {q.subQuestions.map(sub => {
                            const userSubAns = answers[exercise.id]?.[sub.id] || '';
                            let isSubCorrect = false;
                            
                            // Specific check for note making: strict slot matching based on variants provided
                            if (isSubmitted && !sub.locked && sub.variants) {
                                isSubCorrect = checkTextAnswer(userSubAns, sub.variants);
                            }

                            return (
                              <div key={sub.id} className="flex flex-col">
                                <label className="text-sm font-semibold text-gray-600 mb-1">{sub.label}</label>
                                <input
                                  type="text"
                                  value={sub.locked ? sub.value : userSubAns}
                                  onChange={(e) => !sub.locked && handleInput(sub.id, e.target.value)}
                                  disabled={sub.locked || isSubmitted}
                                  className={`w-full p-2 border rounded ${sub.locked ? 'bg-gray-100 text-gray-500 italic' : (isSubmitted ? (isSubCorrect ? 'border-green-500 bg-green-100' : 'border-red-400 bg-red-50') : 'border-gray-300 focus:ring-2 focus:ring-blue-500')}`}
                                  placeholder={sub.locked ? '' : "Type your point here..."}
                                />
                                {isSubmitted && !sub.locked && (
                                  <div className="mt-1 text-xs text-blue-800 font-medium">
                                    <strong>Accepted:</strong> {sub.variants ? sub.variants.join(" / ") : sub.answer}
                                  </div>
                                )}
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    ))}
                  </div>
                );

              default:
                return <div>Unknown exercise type</div>;
            }
          };

          return (
            <div className="h-full overflow-y-auto p-6 bg-gray-50 print:p-0 print:h-auto print:overflow-visible">
              <div className="mb-6 print:mb-4">
                <h2 className="text-2xl font-bold text-gray-900 mb-2">{exercise.title}</h2>
                <p className="text-gray-600 italic">{exercise.instructions}</p>
              </div>
              {renderQuestions()}
            </div>
          );
        };

        const FullExamPrintView = ({ exercises, answers }) => {
          return (
            <div className="hidden print:block space-y-8 p-4">
              <div className="text-center mb-8 border-b pb-4">
                <h1 className="text-2xl font-bold">Cambridge IGCSE™ English as a Second Language</h1>
                <p>Paper 1 Reading and Writing (0510/12)</p>
                <p className="mt-2">Candidate Responses</p>
                <p className="text-sm text-gray-500">Date: {new Date().toLocaleDateString()}</p>
              </div>
              
              {exercises.map((ex, index) => (
                <div key={ex.id} className="break-inside-avoid page-break mb-12">
                   <h2 className="text-xl font-bold mb-4 border-b border-gray-300 pb-2 bg-gray-100 p-2">{ex.title}</h2>
                   
                   {/* Text Section for Reading Exercises */}
                   {ex.text && (
                     <div className="mb-6 p-4 border border-gray-200 rounded text-sm leading-relaxed whitespace-pre-wrap font-serif">
                        <h3 className="font-bold mb-2 underline">{ex.title} - Reading Text</h3>
                        {ex.text}
                     </div>
                   )}

                   {/* Render Questions */}
                   <div className="pl-0">
                      <QuestionPanel 
                        exercise={ex} 
                        answers={answers} 
                        setAnswer={() => {}} 
                        isSubmitted={true}
                      />
                   </div>
                </div>
              ))}
            </div>
          );
        };

        const ResultsSummary = ({ exercises, answers }) => {
          let score = 0;
          let totalMarks = 0;

          exercises.forEach(ex => {
            // Short Answer (Ex 1)
            if (ex.type === 'short-answer') {
                 ex.questions.forEach(q => {
                     totalMarks += q.marks;
                     // Q6 (Multipart)
                     if (q.parts) {
                         let questionScore = 0;
                         q.parts.forEach(part => {
                              const userAns = answers[ex.id]?.[part.id];
                              if (userAns && q.validPoints) {
                                  if (checkTextAnswer(userAns, q.validPoints)) {
                                      questionScore++;
                                  }
                              }
                         });
                         // Cap score at q.marks
                         score += Math.min(questionScore, q.marks);
                     } 
                     // Q1-5 (Single)
                     else {
                         const userAns = answers[ex.id]?.[q.id];
                         if (userAns && q.variants) {
                             if (checkTextAnswer(userAns, q.variants)) {
                                 score += q.marks;
                             }
                         }
                     }
                 });
            } 
            
            // Note Making (Ex 3)
            else if (ex.type === 'note-making') {
                 ex.questions.forEach(q => {
                     q.subQuestions.forEach(sub => {
                         if (!sub.locked) {
                             totalMarks++; 
                             const userAns = answers[ex.id]?.[sub.id];
                             if (userAns && sub.variants) {
                                 if (checkTextAnswer(userAns, sub.variants)) {
                                     score++;
                                 }
                             }
                         }
                     });
                 });
            }
          });

          return (
            <div className="max-w-2xl mx-auto mt-10 p-6 bg-white rounded-lg shadow-lg print:shadow-none print:w-full print:max-w-none print:mt-0 no-print">
              <h2 className="text-3xl font-bold text-center mb-6 text-gray-800">Exam Results</h2>
              
              <div className="flex justify-center mb-8">
                <div className="bg-blue-50 p-6 rounded-lg text-center shadow-md border border-blue-100 min-w-[300px]">
                  <p className="text-sm text-blue-600 uppercase tracking-wide font-bold">Total Score</p>
                  <p className="text-5xl font-bold text-blue-900 mt-2">{score} <span className="text-2xl text-gray-500">/ {totalMarks}</span></p>
                  <p className="text-xs text-blue-400 mt-2 italic">*Includes auto-grading for all questions</p>
                </div>
              </div>

              <div className="text-center">
                <p className="mb-4 text-gray-600">Please review your answers by navigating back through the exam tabs.</p>
                <div className="flex justify-center gap-4">
                  <button 
                    onClick={() => window.print()}
                    className="inline-flex items-center gap-2 px-6 py-3 bg-blue-700 text-white rounded-lg hover:bg-blue-600 transition-colors shadow"
                  >
                    <Printer size={18} /> Print Full Exam & Answers
                  </button>
                </div>
              </div>
            </div>
          );
        };

        // --- MAIN APP ---

        const App = () => {
          const [currentExerciseIndex, setIndex] = useState(0);
          const [answers, setAnswers] = useState({});
          const [timeRemaining, setTimeRemaining] = useState(EXAM_DATA.meta.durationMinutes * 60);
          const [isSubmitted, setIsSubmitted] = useState(false);
          const [showSummary, setShowSummary] = useState(false);

          useEffect(() => {
            if (isSubmitted) return;
            const timer = setInterval(() => {
              setTimeRemaining((prev) => {
                if (prev <= 1) {
                  clearInterval(timer);
                  handleSubmit();
                  return 0;
                }
                return prev - 1;
              });
            }, 1000);
            return () => clearInterval(timer);
          }, [isSubmitted]);

          const updateAnswer = (exId, qId, value) => {
            setAnswers(prev => ({
              ...prev,
              [exId]: {
                ...prev[exId],
                [qId]: value
              }
            }));
          };

          const handleSubmit = () => {
            const confirm = window.confirm("Are you sure you want to finish the exam? You cannot change answers after submitting.");
            if (confirm || timeRemaining === 0) {
              setIsSubmitted(true);
              setShowSummary(true);
            }
          };

          const currentExercise = EXAM_DATA.exercises[currentExerciseIndex];

          if (showSummary) {
            return (
              <div className="min-h-screen bg-gray-100 flex flex-col print:bg-white">
                <Header {...EXAM_DATA.meta} timeRemaining={timeRemaining} isSubmitted={true} />
                <Navigation 
                  exercises={EXAM_DATA.exercises} 
                  currentExerciseIndex={currentExerciseIndex} 
                  setIndex={(idx) => { setIndex(idx); setShowSummary(false); }} 
                  answers={answers}
                  isSubmitted={true}
                />
                
                {/* Print View Component (Hidden by default, shown on print) */}
                <FullExamPrintView exercises={EXAM_DATA.exercises} answers={answers} />
                
                {/* Normal Summary View (Hidden on print) */}
                <ResultsSummary exercises={EXAM_DATA.exercises} answers={answers} />
              </div>
            );
          }

          return (
            <div className="flex flex-col h-screen bg-gray-100 text-gray-900 font-sans print:h-auto">
              <Header {...EXAM_DATA.meta} timeRemaining={timeRemaining} isSubmitted={isSubmitted} />
              
              <Navigation 
                exercises={EXAM_DATA.exercises} 
                currentExerciseIndex={currentExerciseIndex} 
                setIndex={setIndex} 
                answers={answers}
                isSubmitted={isSubmitted}
              />

              <main className="flex-1 flex overflow-hidden print:overflow-visible print:block">
                {/* Interactive Mode: Split View */}
                {/* Left Panel: Reading Text (Only for reading exercises) */}
                {currentExercise.text && (
                  <div className="w-1/2 hidden md:block border-r border-gray-300 h-full bg-white shadow-inner no-print">
                     <TextPanel text={currentExercise.text} title={currentExercise.title} />
                  </div>
                )}

                {/* Right Panel: Questions / Writing Area */}
                <div className={`${currentExercise.text ? 'w-full md:w-1/2' : 'w-full max-w-4xl mx-auto'} h-full bg-gray-50 no-print`}>
                  <QuestionPanel 
                    exercise={currentExercise} 
                    answers={answers} 
                    setAnswer={updateAnswer} 
                    isSubmitted={isSubmitted} 
                  />
                </div>
                
              </main>

              <footer className="bg-white border-t border-gray-200 p-4 flex justify-between items-center no-print">
                <button
                  onClick={() => setIndex(prev => Math.max(0, prev - 1))}
                  disabled={currentExerciseIndex === 0}
                  className="flex items-center gap-1 px-4 py-2 rounded border border-gray-300 hover:bg-gray-100 disabled:opacity-50"
                >
                  <ChevronLeft size={18} /> Previous
                </button>

                {!isSubmitted ? (
                  <button
                    onClick={handleSubmit}
                    className="flex items-center gap-2 px-6 py-2 bg-blue-700 text-white rounded hover:bg-blue-800 font-bold shadow-sm"
                  >
                    <CheckCircle size={18} /> Finish Exam
                  </button>
                ) : (
                  <button
                     onClick={() => setShowSummary(true)}
                     className="px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700 font-bold"
                  >
                    View Summary
                  </button>
                )}

                <button
                  onClick={() => setIndex(prev => Math.min(EXAM_DATA.exercises.length - 1, prev + 1))}
                  disabled={currentExerciseIndex === EXAM_DATA.exercises.length - 1}
                  className="flex items-center gap-1 px-4 py-2 rounded border border-gray-300 hover:bg-gray-100 disabled:opacity-50"
                >
                  Next <ChevronRight size={18} />
                </button>
              </footer>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>